- hosts: jenkins
  gather_facts: False
  remote_user: vagrant
  # sudo は廃止.
  become: yes
  tasks:
    - name: install the httpd server
      yum: name=httpd state=latest

    - name: start httpd server
      service: name=httpd state=running enabled=yes

    - name: yum install java-1.7.0-openjdk
      yum: name=java-1.7.0-openjdk state=installed

    - name: get the Jenkins repository
      get_url: url=http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo dest=/etc/yum.repos.d/jenkins.repo

    - name: add the Jenkins repository
      rpm_key: key=http://pkg.jenkins-ci.org/redhat-stable/jenkins-ci.org.key

    - name: ensure jenkins is at the latest version
      yum: name=jenkins state=latest

    - name: ensure jenkins is running and enabled
      service: name=jenkins state=running enabled=yes

    - name: wget jenkins-cli
      get_url:
        url=http://localhost:8080/jnlpJars/jenkins-cli.jar
        dest=/home/vagrant
        checksum=md5:b5c684faed2b39e21533078a19599348
        force=yes
